# üóÑÔ∏è Database Setup Guide

## Recommended: MongoDB Atlas (Cloud Database)

For production use where others will access your app, **MongoDB Atlas** is the best choice.

### ‚úÖ Why MongoDB Atlas?

- **FREE tier** available (512MB storage - enough for most schedules)
- **Cloud-based** - accessible from anywhere
- **Automatic backups** and security
- **Scalable** - can upgrade as you grow
- **No server maintenance** required
- **Works perfectly with Vercel**

---

## üöÄ MongoDB Atlas Setup (Step-by-Step)

### Step 1: Create Account

1. Go to [mongodb.com/cloud/atlas](https://www.mongodb.com/cloud/atlas)
2. Click **"Try Free"**
3. Sign up with email or Google account

### Step 2: Create a Cluster

1. Choose **"M0 Shared"** (FREE forever)
2. Select your **cloud provider**: AWS, Google Cloud, or Azure
3. Choose **region** closest to your users
4. Cluster name: `NurseSchedule` (or any name)
5. Click **"Create Cluster"** (takes 3-5 minutes)

### Step 3: Create Database User

1. Go to **"Database Access"** (left sidebar)
2. Click **"Add New Database User"**
3. Authentication Method: **Password**
4. Username: `nurseadmin` (or your choice)
5. Password: Click **"Autogenerate Secure Password"** ‚Üí **Copy it!**
6. Database User Privileges: **"Read and write to any database"**
7. Click **"Add User"**

### Step 4: Configure Network Access

1. Go to **"Network Access"** (left sidebar)
2. Click **"Add IP Address"**
3. Click **"Allow Access From Anywhere"** (0.0.0.0/0)
   - ‚ö†Ô∏è This is needed for Vercel deployment
4. Click **"Confirm"**

### Step 5: Get Connection String

1. Go to **"Database"** (left sidebar)
2. Click **"Connect"** button on your cluster
3. Choose **"Connect your application"**
4. Driver: **Node.js**, Version: **5.5 or later**
5. Copy the connection string:
   ```
   mongodb+srv://nurseadmin:<password>@nurseschedule.xxxxx.mongodb.net/?retryWrites=true&w=majority
   ```

### Step 6: Configure Your App

Replace `<password>` with your actual password and add database name:

```
mongodb+srv://nurseadmin:YOUR_PASSWORD@nurseschedule.xxxxx.mongodb.net/nurseDB?retryWrites=true&w=majority
```

**Important**: Replace:
- `YOUR_PASSWORD` with the password you copied
- Add `/nurseDB` before the `?` to specify the database name

---

## üìù Configuration Options

### Option 1: For Local Development

Update your `.env` file:

```env
MONGODB_URI=mongodb+srv://nurseadmin:YOUR_PASSWORD@nurseschedule.xxxxx.mongodb.net/nurseDB?retryWrites=true&w=majority
PORT=3000
```

### Option 2: For Vercel (Production)

In Vercel Dashboard:
1. Go to **Settings** ‚Üí **Environment Variables**
2. Add variable:
   - **Name**: `MONGODB_URI`
   - **Value**: `mongodb+srv://nurseadmin:YOUR_PASSWORD@nurseschedule.xxxxx.mongodb.net/nurseDB?retryWrites=true&w=majority`
3. Save and redeploy

---

## üîÑ Database Comparison

### MongoDB Atlas (Recommended ‚úÖ)
| Feature | Details |
|---------|---------|
| **Cost** | FREE (up to 512MB) |
| **Setup** | 10 minutes |
| **Accessibility** | Anywhere with internet |
| **Backup** | Automatic |
| **Scalability** | Easy to upgrade |
| **Maintenance** | Fully managed |
| **Best for** | Production, multiple users |

### Local MongoDB (Development Only ‚ö†Ô∏è)
| Feature | Details |
|---------|---------|
| **Cost** | FREE |
| **Setup** | 15 minutes |
| **Accessibility** | Only your computer |
| **Backup** | Manual |
| **Scalability** | Limited |
| **Maintenance** | You manage it |
| **Best for** | Local development only |

---

## üîê Security Best Practices

1. **Never commit credentials to Git**
   - Use `.env` file (already in `.gitignore`)
   - Use Vercel environment variables

2. **Use strong passwords**
   - Use MongoDB's autogenerated passwords
   - Store safely in password manager

3. **Rotate credentials regularly**
   - Change database password every 3-6 months
   - Update in Vercel environment variables

4. **Monitor database access**
   - Check MongoDB Atlas metrics regularly
   - Review access logs for suspicious activity

---

## üìä Data Management

### View Your Data

1. Go to MongoDB Atlas Dashboard
2. Click **"Browse Collections"**
3. Select database: `nurseDB`
4. View collections:
   - `staffs` - Staff members
   - `schedules` - Generated schedules
   - `unavailabilities` - Day-off requests
   - `shiftrequests` - Shift requests

### Backup Your Data

**Automatic (Atlas):**
- M0 FREE tier: Snapshots available (limited)
- Paid tiers: Daily automatic backups

**Manual Export:**
```powershell
# Install MongoDB Database Tools
# Download from: https://www.mongodb.com/try/download/database-tools

# Export all data
mongodump --uri="mongodb+srv://username:password@cluster.mongodb.net/nurseDB"

# Import data
mongorestore --uri="mongodb+srv://username:password@cluster.mongodb.net/nurseDB" dump/
```

### Delete Old Schedules

Use the app's **"Delete Schedule"** feature or:

```javascript
// In MongoDB Atlas ‚Üí Collections ‚Üí schedules
// Use the Query filter:
{ "date": { "$lt": new Date("2025-01-01") } }
// Then click "Delete Documents"
```

---

## üö® Troubleshooting

### Error: "MongoServerError: bad auth"
**Solution**: 
- Check username and password in connection string
- Make sure you replaced `<password>` with actual password
- No special characters should be URL-encoded

### Error: "Connection timeout"
**Solution**:
- Check Network Access in Atlas (should have 0.0.0.0/0)
- Verify connection string is correct
- Check if cluster is still provisioning (wait a few minutes)

### Error: "Database not found"
**Solution**:
- MongoDB creates databases automatically on first write
- Make sure `/nurseDB` is in your connection string
- Add a staff member to create the database

---

## üí∞ Cost Considerations

### FREE Tier (M0) - Recommended for Most Users
- **Storage**: 512MB
- **RAM**: 512MB
- **Capacity**: ~1000+ schedules
- **Backups**: Limited snapshots
- **Cost**: $0/month forever

### When to Upgrade?
Upgrade to M10 ($0.08/hr ‚âà $57/month) if:
- You have 100+ staff members
- Storing years of historical schedules
- Need advanced backup options
- Require better performance

**For most healthcare facilities**: FREE tier is sufficient!

---

## üìà Scaling Your Database

### Current FREE tier can handle:
- ‚úÖ 50-100 staff members
- ‚úÖ 12+ months of schedules
- ‚úÖ Thousands of shift requests
- ‚úÖ Multiple concurrent users

### If you need more:
1. Go to Atlas Dashboard
2. Click **"Edit Configuration"**
3. Choose larger tier (M10, M20, etc.)
4. Click **"Review Changes"** ‚Üí **"Apply Changes"**
5. No code changes needed!

---

## üîÑ Migration from Local to Atlas

Already using local MongoDB? Migrate easily:

```powershell
# Export from local
mongodump --db=nurseDB --out=backup

# Import to Atlas
mongorestore --uri="mongodb+srv://user:pass@cluster.net/nurseDB" backup/nurseDB
```

---

## ‚úÖ Setup Checklist

- [ ] Create MongoDB Atlas account
- [ ] Create FREE M0 cluster
- [ ] Create database user with password
- [ ] Configure Network Access (0.0.0.0/0)
- [ ] Get connection string
- [ ] Replace `<password>` and add `/nurseDB`
- [ ] Add to `.env` file locally
- [ ] Add to Vercel environment variables
- [ ] Test connection by adding staff member
- [ ] Verify data in Atlas dashboard

---

## üéì Learn More

- [MongoDB Atlas Documentation](https://docs.atlas.mongodb.com)
- [Connection String Format](https://www.mongodb.com/docs/manual/reference/connection-string/)
- [Database Security Checklist](https://www.mongodb.com/docs/manual/security/)

---

**Need Help?** Open an issue on GitHub or check MongoDB Atlas support!
